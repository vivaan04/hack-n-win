<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Explore - Banasthali Vidyapith</title>

  <style>
    /**************************************************************
     * 1) BASIC RESET & COLOR VARIABLES
     **************************************************************/
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    :root {
      --apple-green: #85c47c;
      --apple-green-dark: #6ba563;
      --white: #ffffff;
      --text-dark: #333;
      --light-bg: #f5f9f4; /* optional background */
      --shadow-color: rgba(0, 0, 0, 0.1);
    }

    /**************************************************************
     * 2) BASIC PAGE STYLES
     **************************************************************/
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--light-bg);
      color: var(--text-dark);
      height: 100vh;
      overflow: hidden; /* No scrollbar for body; remove if you prefer one */
    }
    .container {
      position: relative;
      width: 100vw;
      height: 100vh;
      display: flex; /* left column takes up the space, overlay is absolute */
    }

    /**************************************************************
     * 3) LEFT COLUMN (MAIN CONTENT: SEARCH + RESULTS)
     **************************************************************/
    .left-column {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 20px;
      background-color: var(--white);
      box-shadow: 2px 0 5px var(--shadow-color);
      overflow-y: auto;
    }

    /* Top bar with "Explore" and "Menu" button */
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .top-bar h1 {
      font-size: 22px;
      color: var(--text-dark);
    }
    .menu-button {
      background-color: var(--apple-green);
      color: var(--white);
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s, transform 0.3s;
    }
    .menu-button:hover {
      background-color: var(--apple-green-dark);
      transform: scale(1.05);
    }

    /* Search bar */
    .search-bar {
      position: relative;
      margin-bottom: 20px;
    }
    .search-bar input {
      width: 100%;
      padding: 12px 20px;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 25px;
      outline: none;
      box-shadow: 2px 2px 8px var(--shadow-color);
      transition: border-color 0.3s ease;
    }
    .search-bar input:focus {
      border-color: var(--apple-green);
    }

    /* Results area */
    .list-container {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      overflow-y: auto;
    }
    .list-container ul {
      list-style-type: none;
      padding: 0;
      width: 100%;
    }
    .list-container ul li {
      font-size: 18px;
      font-weight: bold;
      padding: 10px 15px;
      margin: 5px 0;
      background-color: var(--white);
      border-radius: 8px;
      box-shadow: 2px 2px 8px var(--shadow-color);
      transition: transform 0.2s, background 0.2s, box-shadow 0.2s;
    }
    .list-container ul li:hover {
      background-color: #f8f9fa;
      transform: scale(1.02);
      box-shadow: 0 4px 12px var(--shadow-color);
    }
    .no-results {
      font-size: 18px;
      color: #555;
      text-align: center;
      margin-top: 20px;
      width: 100%;
    }

    /**************************************************************
     * 4) RIGHT OVERLAY MENU (APPLE GREEN)
     **************************************************************/
    .right-overlay {
      position: absolute;
      top: 0;
      right: 0;
      width: 300px;
      height: 100%;
      background-color: var(--apple-green);
      color: var(--white);
      box-shadow: -2px 0 5px var(--shadow-color);
      transform: translateX(100%); /* hidden by default */
      transition: transform 0.4s ease;
      display: flex;
      flex-direction: column;
      padding: 20px;
      z-index: 999;
    }
    /* Show the overlay by removing translateX */
    .right-overlay.show {
      transform: translateX(0);
    }

    /* Overlay Header (title + close button) */
    .overlay-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .overlay-header h2 {
      margin: 0;
      font-size: 1.3rem;
    }
    .close-btn {
      background-color: transparent;
      border: 2px solid var(--white);
      border-radius: 50%;
      color: var(--white);
      font-size: 1.2rem;
      width: 36px;
      height: 36px;
      cursor: pointer;
      transition: background 0.3s, transform 0.3s;
    }
    .close-btn:hover {
      background-color: var(--apple-green-dark);
      transform: scale(1.1);
    }

    /* Category buttons in the overlay */
    .categories-overlay {
      flex: 1; /* fill remaining space */
      display: flex;
      flex-direction: column;
      gap: 10px; /* space between buttons */
    }
    .categories-overlay a {
      background-color: var(--white);
      color: var(--apple-green-dark);
      padding: 12px 15px;
      border-radius: 8px;
      text-align: center;
      text-decoration: none;
      font-weight: bold;
      transition: 0.3s;
    }
    .categories-overlay a:hover {
      background-color: #e0e8df; /* slightly tinted white */
      transform: scale(1.05);
    }

    /**************************************************************
     * 5) MEDIA QUERIES
     **************************************************************/
    @media (max-width: 768px) {
      .right-overlay {
        width: 80%;
      }
    }
  </style>
</head>
<body>

<div class="container">
  <!-- LEFT COLUMN: Search & Results -->
  <div class="left-column">
    <!-- Top bar with "Explore" and "Menu" button -->
    <div class="top-bar">
      <h1>Explore</h1>
      <button class="menu-button" id="openOverlayBtn">Menu</button>
    </div>

    <!-- Search bar -->
    <div class="search-bar">
      <input 
        type="text" 
        placeholder="Where are you going?" 
        id="search-bar" 
        onkeydown="handleSearch(event)"
      />
    </div>

    <!-- Results area -->
    <div id="content" class="list-container"></div>
  </div>

  <!-- RIGHT OVERLAY: Apple Green, 4 Category Buttons -->
  <div class="right-overlay" id="overlayPanel">
    <div class="overlay-header">
      <h2>Categories</h2>
      <button class="close-btn" id="closeOverlayBtn">&times;</button>
    </div>
    <div class="categories-overlay">
      <a href="#" onclick="loadCategory('hostels')">Hostels</a>
      <a href="#" onclick="loadCategory('departments')">Departments</a>
      <a href="#" onclick="loadCategory('markets')">Markets</a>
      <a href="#" onclick="loadCategory('grounds')">Grounds</a>
    </div>
  </div>
</div>

<script>
   src="map.js"
  // 1) Configure your Node.js server base URL
  const BASE_URL = 'http://localhost:3001/api';

  // 2) Overlay references
  const overlayPanel = document.getElementById('overlayPanel');
  const openOverlayBtn = document.getElementById('openOverlayBtn');
  const closeOverlayBtn = document.getElementById('closeOverlayBtn');
  const contentDiv = document.getElementById('content');

  // Show overlay
  openOverlayBtn.addEventListener('click', () => {
    overlayPanel.classList.add('show');
  });
  // Hide overlay
  closeOverlayBtn.addEventListener('click', () => {
    overlayPanel.classList.remove('show');
  });

  /************************************************************
   * loadCategory(category)
   * Fetches data from /api/<category> (or /api/grounds) 
   * then displays it on the left column (#content).
   ************************************************************/
  function loadCategory(category) {
    // Hide overlay after click
    overlayPanel.classList.remove('show');

    let endpoint;
    if (category === 'grounds') {
      endpoint = `${BASE_URL}/grounds`;
    } else {
      endpoint = `${BASE_URL}/${category}`;
    }

    fetch(endpoint)
      .then(response => response.json())
      .then(data => {
        displayCategoryResults(category, data);
      })
      .catch(err => {
        console.error('Error fetching category:', err);
        displayCategoryResults(category, []);
      });
  }

  function displayCategoryResults(category, items) {
    contentDiv.innerHTML = ''; // clear old content

    if (!items || items.length === 0) {
      contentDiv.innerHTML = '<p class="no-results">No results found.</p>';
      return;
    }

    let html = '<ul>';
    items.forEach(item => {
      // If your server returns item.id, you can use that. 
      // Otherwise fallback to item.name
      const itemId = encodeURIComponent(
        (item.id || item.name).toLowerCase().replace(/\s+/g, '-')
      );
      html += `
        <li>
          <a href="details.html?category=${encodeURIComponent(category)}&id=${itemId}">
            ${item.name}
          </a>
        </li>
      `;
    });
    html += '</ul>';

    contentDiv.innerHTML = html;
  }

  /************************************************************
   * handleSearch(event)
   * On Enter key => calls /api/search?q=...
   * Then displays results in left column.
   ************************************************************/
  function handleSearch(event) {
    if (event.key === 'Enter') {
      const query = event.target.value.trim();
      if (!query) return;

      const url = `${BASE_URL}/search?q=${encodeURIComponent(query)}`;
      fetch(url)
        .then(response => response.json())
        .then(data => {
          displaySearchResults(data);
        })
        .catch(err => {
          console.error('Error searching:', err);
          displaySearchResults([]);
        });
    }
  }

  function displaySearchResults(items) {
    contentDiv.innerHTML = '';

    if (!items || items.length === 0) {
      contentDiv.innerHTML = '<p class="no-results">No results found.</p>';
      return;
    }

    let html = '<ul>';
    items.forEach(row => {
      const categoryParam = encodeURIComponent(row.source);
      const itemId = encodeURIComponent(
        (row.name || '').toLowerCase().replace(/\s+/g, '-')
      );
      html += `
        <li>
          <a href="details.html?category=${categoryParam}&id=${itemId}">
            ${row.source}: ${row.name}
          </a>
        </li>
      `;
    });
    html += '</ul>';

    contentDiv.innerHTML = html;
  }
</script>
</body>
</html>
